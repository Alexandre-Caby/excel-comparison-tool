<div class="page-header">
    <h1>Mentions Légales</h1>
    <p>Informations légales et conditions d'utilisation</p>
</div>

<div class="legal-tabs">
    <button class="legal-tab active" data-doc="terms">Conditions d'utilisation</button>
    <button class="legal-tab" data-doc="privacy">Politique de confidentialité</button>
    <button class="legal-tab" data-doc="license">Licence</button>
</div>

<div id="legal-content" class="doc-container">
    <div class="loading-docs">
        <div class="loading-spinner"></div>
        <p>Chargement des mentions légales...</p>
    </div>
</div>

<script>
(function() {
    const legalContent = document.getElementById('legal-content');
    let currentDoc = 'terms';
    
    // Fallback content for each document
    const fallbackContent = {
        terms: `
            <h1>Conditions d'utilisation - ECT Technis</h1>
            
            <h2>1. Acceptation des conditions</h2>
            <p>En utilisant ECT Technis, vous acceptez les présentes conditions d'utilisation.</p>
            
            <h2>2. Description du service</h2>
            <p>ECT Technis est un outil de comparaison de fichiers Excel conçu pour :</p>
            <ul>
                <li>Comparer des données entre différents fichiers Excel</li>
                <li>Générer des rapports de différences</li>
                <li>Analyser les données PHP</li>
                <li>Exporter les résultats dans différents formats</li>
            </ul>
            
            <h2>3. Utilisation autorisée</h2>
            <p>Vous pouvez utiliser ECT Technis pour :</p>
            <ul>
                <li>L'analyse de données professionnelles</li>
                <li>La comparaison de fichiers Excel</li>
                <li>La génération de rapports</li>
            </ul>
            
            <h2>4. Restrictions</h2>
            <ul>
                <li>Ne pas redistribuer le logiciel sans autorisation</li>
                <li>Ne pas modifier le code source</li>
                <li>Utilisation limitée aux besoins légitimes</li>
            </ul>
            
            <h2>5. Responsabilité</h2>
            <p>L'utilisateur est responsable de :</p>
            <ul>
                <li>La validité des données traitées</li>
                <li>La sauvegarde de ses fichiers</li>
                <li>L'utilisation conforme du logiciel</li>
            </ul>
            
            <h2>6. Support</h2>
            <p>Le support technique est disponible pendant les heures ouvrables.</p>
            
            <h2>7. Modifications</h2>
            <p>Ces conditions peuvent être modifiées. Les utilisateurs seront informés des changements importants.</p>
            
            <p><em>Dernière mise à jour : Janvier 2025</em></p>
        `,
        privacy: `
            <h1>Politique de confidentialité - ECT Technis</h1>
            
            <h2>1. Collecte des données</h2>
            <p>ECT Technis ne collecte aucune donnée personnelle. L'application fonctionne localement sur votre ordinateur.</p>
            
            <h2>2. Traitement des fichiers</h2>
            <p>Vos fichiers Excel sont traités localement :</p>
            <ul>
                <li>Aucune donnée n'est envoyée vers des serveurs externes</li>
                <li>Les fichiers temporaires sont supprimés automatiquement</li>
                <li>Aucune sauvegarde n'est effectuée sans votre accord</li>
            </ul>
            
            <h2>3. Données temporaires</h2>
            <p>L'application peut créer des fichiers temporaires pour :</p>
            <ul>
                <li>Le traitement des comparaisons</li>
                <li>La génération de rapports</li>
                <li>Le cache des résultats</li>
            </ul>
            <p>Ces fichiers sont automatiquement supprimés à la fermeture de l'application.</p>
            
            <h2>4. Logs d'application</h2>
            <p>L'application peut créer des logs techniques pour :</p>
            <ul>
                <li>Le débogage</li>
                <li>L'amélioration des performances</li>
                <li>La résolution de problèmes</li>
            </ul>
            <p>Ces logs ne contiennent pas de données sensibles de vos fichiers.</p>
            
            <h2>5. Sécurité</h2>
            <p>Nous nous engageons à :</p>
            <ul>
                <li>Protéger l'intégrité de vos données</li>
                <li>Ne pas accéder à vos fichiers sans autorisation</li>
                <li>Maintenir la confidentialité de vos informations</li>
            </ul>
            
            <h2>6. Contact</h2>
            <p>Pour toute question concernant cette politique, contactez le support technique.</p>
            
            <p><em>Dernière mise à jour : Janvier 2025</em></p>
        `,
        license: `
            <h1>Licence - ECT Technis</h1>
            
            <h2>Licence d'utilisation</h2>
            <p>ECT Technis est fourni sous licence propriétaire limitée.</p>
            
            <h2>Droits accordés</h2>
            <p>Cette licence vous accorde le droit de :</p>
            <ul>
                <li>Utiliser le logiciel à des fins professionnelles</li>
                <li>Installer l'application sur vos ordinateurs</li>
                <li>Créer des sauvegardes pour usage personnel</li>
            </ul>
            
            <h2>Restrictions</h2>
            <ul>
                <li>Redistribution interdite sans autorisation écrite</li>
                <li>Modification du code source interdite</li>
                <li>Utilisation limitée aux besoins légitimes</li>
                <li>Pas de rétroingénierie autorisée</li>
            </ul>
            
            <h2>Propriété intellectuelle</h2>
            <p>Tous les droits de propriété intellectuelle sur ECT Technis sont réservés.</p>
            
            <h2>Garantie</h2>
            <p>Le logiciel est fourni "en l'état" sans garantie explicite ou implicite.</p>
            
            <h2>Limitation de responsabilité</h2>
            <p>En aucun cas nous ne pourrons être tenus responsables de dommages directs ou indirects résultant de l'utilisation du logiciel.</p>
            
            <h2>Résiliation</h2>
            <p>Cette licence prend fin automatiquement en cas de non-respect des conditions.</p>
            
            <p><em>Version de licence : 1.0 - Janvier 2025</em></p>
        `
    };
    
    // File mapping for API calls
    const fileMap = {
        'terms': 'terms_of_use.md',
        'privacy': 'privacy_policy.md', 
        'license': 'licence.md'
    };
    
     function loadDocument(docType) {
        try {
            console.log(`Loading ${docType} document...`);
            
            // Always set fallback content immediately
            showContent(fallbackContent[docType]);

            if (window.api && window.BACKEND_URL) {
                const filename = fileMap[docType];
                if (filename) {
                    console.log(`API available, attempting to load ${filename} from backend...`);
                    
                    // Just attempt this in the background
                    window.api.loadLegalDocument(filename)
                        .then(markdown => {
                            if (markdown && markdown.trim()) {
                                const html = window.api.markdownToHtml(markdown);
                                showContent(html);
                                console.log(`${docType} document loaded from backend`);
                            }
                        })
                        .catch(error => {
                            console.log(`Using fallback content for ${docType} due to API error:`, error.message);
                        });
                }
            }
        } catch (error) {
            console.error(`Error in ${docType} document loading:`, error);
            showContent(fallbackContent[docType]);
        }
    }
    
    function showContent(htmlContent) {
        legalContent.innerHTML = `
            <div class="legal-card">
                <div class="card-body legal-body">
                    ${htmlContent}
                </div>
            </div>
        `;
    }
    
    // Set up tab functionality
    document.querySelectorAll('.legal-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.legal-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            const docType = tab.getAttribute('data-doc');
            currentDoc = docType;
            loadDocument(docType);
        });
    });
    
    // Execute immediately, don't wait for events
    loadDocument(currentDoc);
})();
</script>