<div class="page-header">
    <h1>Guide d'Utilisation</h1>
    <p>Tout ce dont vous avez besoin pour utiliser ECT Technis efficacement</p>
</div>

<div id="help-content" class="doc-container">
    <div class="loading-docs">
        <div class="loading-spinner"></div>
        <p>Chargement de la documentation...</p>
    </div>
</div>

<script>
(function() {
    const helpContent = document.getElementById('help-content');
    
    // Fallback content that always works
    const fallbackContent = `
        <div class="help-card">
            <div class="card-body help-body">
                <h1>Guide d'utilisation - ECT Technis</h1>
                
                <h2>Démarrage rapide</h2>
                <ol>
                    <li><strong>Téléchargement des fichiers :</strong>
                        <ul>
                            <li>Allez dans la section "Téléchargement"</li>
                            <li>Téléchargez d'abord votre fichier de base (référence)</li>
                            <li>Puis téléchargez vos fichiers de comparaison</li>
                        </ul>
                    </li>
                    
                    <li><strong>Configuration :</strong>
                        <ul>
                            <li>Définissez les correspondances de codes de sites (ex: LE → Lens)</li>
                            <li>Sélectionnez les feuilles à comparer</li>
                            <li>Choisissez le mode de comparaison (complet/rapide)</li>
                        </ul>
                    </li>
                    
                    <li><strong>Comparaison :</strong>
                        <ul>
                            <li>Lancez la comparaison depuis la page "Comparaison"</li>
                            <li>Attendez que l'analyse se termine</li>
                            <li>Consultez les résultats détaillés</li>
                        </ul>
                    </li>
                    
                    <li><strong>Rapports :</strong>
                        <ul>
                            <li>Sauvegardez vos résultats</li>
                            <li>Exportez en Excel, CSV ou PDF</li>
                            <li>Consultez l'historique des comparaisons</li>
                        </ul>
                    </li>
                </ol>
                
                <h2>Fonctionnalités principales</h2>
                
                <h3>Détection automatique des en-têtes</h3>
                <p>L'application détecte automatiquement les lignes d'en-tête dans vos fichiers Excel pour une comparaison précise.</p>
                
                <h3>Codes de sites</h3>
                <p>Configurez les correspondances entre codes courts et noms complets :</p>
                <ul>
                    <li><strong>LE</strong> → Lens</li>
                    <li><strong>BGL</strong> → BGL</li>
                    <li>Ajoutez vos propres correspondances selon vos besoins</li>
                </ul>
                
                <h3>Modes de comparaison</h3>
                <ul>
                    <li><strong>Complet :</strong> Analyse détaillée de toutes les données</li>
                    <li><strong>Rapide :</strong> Comparaison optimisée pour les gros fichiers</li>
                </ul>
                
                <h3>Formats d'export</h3>
                <ul>
                    <li><strong>Excel :</strong> Rapport complet avec formatage</li>
                    <li><strong>CSV :</strong> Données brutes pour traitement</li>
                    <li><strong>PDF :</strong> Rapport imprimable</li>
                </ul>
                
                <h2>Analyse PHP</h2>
                <p>Fonctionnalité spécialisée pour l'analyse des fichiers PHP avec :</p>
                <ul>
                    <li>Analyse par semaine</li>
                    <li>Détection des données manquantes</li>
                    <li>Rapports statistiques détaillés</li>
                </ul>
                
                <h2>Conseils d'utilisation</h2>
                
                <h3>Préparation des fichiers</h3>
                <ul>
                    <li>Assurez-vous que vos fichiers Excel sont au format .xlsx ou .xls</li>
                    <li>Vérifiez que les colonnes importantes sont bien remplies</li>
                    <li>Les noms de feuilles doivent être cohérents entre fichiers</li>
                </ul>
                
                <h3>Performance</h3>
                <ul>
                    <li>Pour les gros fichiers, utilisez le mode "Rapide"</li>
                    <li>Fermez les autres applications pour libérer de la mémoire</li>
                    <li>Attendez la fin de la comparaison avant d'effectuer d'autres actions</li>
                </ul>
                
                <h2>Dépannage</h2>
                
                <h3>Problèmes courants</h3>
                <ul>
                    <li><strong>Fichier non reconnu :</strong> Vérifiez le format (Excel uniquement)</li>
                    <li><strong>Comparaison lente :</strong> Utilisez le mode rapide ou réduisez la taille des fichiers</li>
                    <li><strong>Résultats inattendus :</strong> Vérifiez les correspondances de sites</li>
                </ul>
                
                <h3>Support</h3>
                <p>En cas de problème persistant :</p>
                <ul>
                    <li>Redémarrez l'application</li>
                    <li>Vérifiez que vos fichiers sont valides</li>
                    <li>Contactez le support technique si nécessaire</li>
                </ul>
                
                <p><em>Version de l'application : ECT Technis v1.2.0</em></p>
            </div>
        </div>
    `;
    
    function renderHTMLContent(html) {
        // Remove loading spinner
        const loading = helpContent.querySelector('.loading-docs');
        if (loading) loading.remove();

        helpContent.innerHTML = `
            <div class="help-card">
                <div class="card-body help-body">
                    ${html}
                </div>
            </div>
        `;
    }

    function loadHelpContent() {
        try {
            // Always show fallback first (instant feedback)
            renderHTMLContent(window.api.markdownToHtml(`# Guide d'utilisation (fallback)`));

            // Try loading from backend
            if (window.api && window.BACKEND_URL) {
                window.api.loadUserGuide()
                    .then(markdown => {
                        if (markdown && markdown.trim()) {
                            const html = window.api.markdownToHtml(markdown);
                            renderHTMLContent(html);
                        }
                    })
                    .catch(error => {
                        console.warn('Fallback content used due to error:', error);
                    });
            }
        } catch (err) {
            console.error('Error rendering help content:', err);
        }
    }

    // Execute immediately
    loadHelpContent();
})();
</script>
